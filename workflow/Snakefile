from snakebids import bids, generate_inputs
import groups

configfile: 'config/config.yml'

config.update(generate_inputs(
    bids_dir=config['bids_dir'],
    pybids_inputs=config['pybids_inputs'],
    derivatives=config['preprocessed_data']
))

wildcards = config['input_wildcards']['preproc_dwi']
work = config['output_dir']
qc = config['output_dir'] + "/qc"

output = config['output_dir']


include: 'rules/anatomical_segmentation.smk'
include: "rules/response_function.smk"
include: 'rules/reconstruction.smk'
include: "rules/qc.smk"

localrules: all, qc

rule all:
    input:
        expand(bids(root=output,
            datatype='dwi',
            desc="tracks",
            suffix='10M.tck',
            **wildcards),
                **config['input_lists']['preproc_dwi'])

rule qc:
    input:
        expand(bids(root=qc,
            datatype='dwi',
            suffix='{suffixes}',
            **wildcards),
                **config['input_lists']['preproc_dwi'],
                suffixes=["viewTractography", "viewOdf", "viewInterface"])




