#!/usr/bin/env python3

import argparse
import subprocess
import sys

parser = argparse.ArgumentParser()

parser.add_argument('--mem', nargs=1, default="64G")
parser.add_argument('--runtime', nargs=1, default='12:00')
parser.add_argument('--cores', nargs="+", type=int)
parser.add_argument('--rules', nargs="+", type=str)
parser.add_argument('-subjects', nargs="+", type=str)
parser.add_argument('--snakemake-args', nargs="*")

args = parser.parse_args(sys.argv)

for core, subject in zip(args.cores, args.subjects):
    print(" ".join([
        "kbatch",
        core,
        args.mem,
        args.runtime,
        "snakemake",
        "--profile",
        "single"
        "--max-threads",
        core,
        "--cores",
        core,
        "--config",
        f"participant_label={subject}"
    ]))
